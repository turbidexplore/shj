<!doctype html>
<html class="no-js h-100" lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>设汇家 ｜ 泛家居行业供应链平台</title>
    <meta name="keywords" content="浑浊探索,苏州浑浊信息科技有限公司,turbid,explore,科技">
    <meta name="description" content="设汇家官网">
    <meta name="author" content="设汇家">    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <style>
        /* fallback */
        @font-face {
            font-family: 'Material Icons';
            font-style: normal;
            font-weight: 400;
            src: url(../css/flUhRq6tzZclQEJ-Vdg-IuiaDsNcIhQ8tQ.woff2) format('woff2');
        }

        .material-icons {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }
    </style>
    <link href="../styles/all.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/allcss.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" id="main-stylesheet" data-version="1.1.0" href="../styles/shards-dashboards.1.1.0.min.css">
    <link rel="stylesheet" href="../styles/extras.1.1.0.min.css">
    <link rel="stylesheet" href="../layui/css/layui.css">

  <body class="h-100">
     <div class="container-fluid">
      <div class="row">
        <!-- Main Sidebar -->
        <aside class="main-sidebar col-12 col-md-3 col-lg-2 px-0">
          <div class="main-navbar">
            <nav class="navbar align-items-stretch navbar-light bg-white flex-md-nowrap border-bottom p-0">
              <a class="navbar-brand w-100 mr-0" href="#" style="line-height: 25px;">
                <div class="d-table m-auto">
                  <span class="d-none d-md-inline ml-1">设汇+</span>
                </div>
              </a>
              <a class="toggle-sidebar d-sm-inline d-md-none d-lg-none">
                <i class="material-icons">&#xE5C4;</i>
              </a>
            </nav>
          </div>
          <form action="#" class="main-sidebar__search w-100 border-right d-sm-flex d-md-none d-lg-none">
            <div class="input-group input-group-seamless ml-3">
              <div class="input-group-prepend">
                <div class="input-group-text">
                  <i class="fas fa-search"></i>
                </div>
              </div>
              <input class="navbar-search form-control" type="text" placeholder="Search for something..." aria-label="Search"> </div>
          </form>
          <div class="nav-wrapper">
            <ul class="nav flex-column">
              <li class="nav-item ">
                <a class="nav-link " href="/managehtindex">
                  <i class="material-icons">vertical_split</i>
                  <span>首页</span>
                </a>
              </li>
              <li class="nav-item ">
                <a class="nav-link " href="/manageuser">
                  <i class="material-icons">table_chart</i>
                  <span>企业管理</span>
                </a>
              </li>
              <li class="nav-item ">
                <a class="nav-link " href="/manageuserinfos">
                  <i class="material-icons">vertical_split</i>
                  <span>用户管理</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link " href="/manageintegralgoods">
                  <i class="material-icons">vertical_split</i>
                  <span>积分商品管理</span>
                </a>
              </li>
              <li class="nav-item ">
                <a class="nav-link " href="/manageshopingmanage">
                  <i class="material-icons">table_chart</i>
                  <span>积分商品发货管理</span>
                </a>
              </li>
              <li class="nav-item ">
                <a class="nav-link " href="/managebanners">
                  <i class="material-icons">vertical_split</i>
                  <span>广告管理</span>
                </a>
              </li>
              <li class="nav-item ">
                <a class="nav-link " href="/managenativecontent">
                  <i class="material-icons">note_add</i>
                  <span>内容中心</span>
                </a>
              </li>
              <li class="nav-item active">
                <a class="nav-link " href="/managestudysgroup">
                  <i class="material-icons">vertical_split</i>
                  <span>课程管理</span>
                </a>
              </li>
              <li class="nav-item ">
                <a class="nav-link " href="/managescaseauth">
                  <i class="material-icons">vertical_split</i>
                  <span>案例审查</span>
                </a>
              </li>
              <li class="nav-item ">
                <a class="nav-link " href="/managescases">
                  <i class="material-icons">vertical_split</i>
                  <span>案例管理</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link " href="/managesproducts">
                  <i class="material-icons">vertical_split</i>
                  <span>需求审查</span>
                </a>
              </li>
            </ul>
          </div>
        </aside>
        <!-- End Main Sidebar -->

        <main class="main-content col-lg-10 col-md-9 col-sm-12 p-0 offset-lg-2 offset-md-3">
          <!-- / .main-navbar -->
          <div class="main-content-container container-fluid px-4">
            <!-- Page Header -->
            <div class="col-lg-12 col-md-12" style="position: fixed;bottom: 0;z-index:100;background-color: #ffffff;padding: 5px;">
              <button type="button"  class="mb-2 btn btn-sm btn-primary mr-1" onclick="savaData()">保存</button>
            </div>
            <!-- End Page Header -->
            <div class="row" style="margin-top: 8px;">

              <div class="col-lg-7 col-md-12">
                <!-- Add New Post Form -->
                <div class="card card-small mb-3">
                  <div class="card-body">
                    <form class="add-new-post">
                      <div class="form-row">
                        <div class="form-group col-md-8">
                          <label for="title">课程组标题</label>
                          <input type="text" class="form-control" id="title" placeholder="课程标题">
                        </div>
                        <div class="form-group col-md-4">
                          <label for="type">课程组类型</label>
                          <select id="type" class="form-control">
                          </select>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group col-md-4">
                          <label for="pricetype">价格类型</label>
                          <select id="pricetype" class="form-control">
                            <option value="0">免费</option>
                            <option value="1">收费</option>
                          </select>
                        </div>
                        <div class="form-group col-md-4">
                          <label for="price">价格</label>
                          <input type="text" class="form-control" id="price" placeholder="价格" value="0">
                        </div>
                        <div class="form-group col-md-4">
                          <label for="indextype">显示类型</label>
                          <select id="indextype" class="form-control">
                            <option value="0">视频</option>
                            <option value="1">封面</option>
                          </select>
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group col-md-3">
                          <label for="teachername">老师名称</label>
                          <input type="text" class="form-control" id="teachername" placeholder="老师名称">
                        </div>
                        <div class="form-group col-md-5">
                          <label for="teacherdesc">老师介绍</label>
                          <input type="text" class="form-control" id="teacherdesc" placeholder="老师介绍">
                        </div>
                        <div class="form-group col-md-4">
                          <label for="teacherslogan">老师简短介绍</label>
                          <input type="text" class="form-control" id="teacherslogan" placeholder="老师简短介绍">
                        </div>
                      </div>
                      <div class="form-row">
                        <div class="form-group col-md-7">
                          <label for="indeximgurl">封面</label>
                          <div class="mb-3 mx-auto">
                            <img src="https://tubrid-1258088094.cos.ap-beijing.myqcloud.com/%E8%AF%BE%E7%A8%8B%E5%B0%81%E9%9D%A2/09.17/%E5%9B%BD%E9%99%85%E5%93%81%E7%89%8C%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F%20%E8%BD%BB%E5%A5%A2%E7%AF%87.png" alt="User Avatar" width="280" id="indeximgurl"> </div>
                          <a href="javascript:;" class="file">上传图片
                            <input type="file" id="indeximg"  />
                          </a>
                        </div>


                        <div class="form-group col-md-5">
                          <label for="teacherheadurl">老师照片</label>
                          <div class="mb-3 mx-auto">
                            <img src="" alt="User Avatar" width="80" id="teacherheadurl"> </div>
                          <a href="javascript:;" class="file">上传图片
                            <input type="file" id="logo"  />
                          </a>
                        </div>
                      </div>


                    </form>
                  </div>
                </div>
              </div>

              <div class="col-lg-5 col-md-12">
                <!-- Add New Post Form -->
                <div class="card card-small mb-3">
                  <div class="card-body">
                    <form class="add-new-post">
                      <span>课程组展示内容</span>
                      <textarea class="easyui-validatebox" name="newsMatter" id="newsMatter" rows="60" cols="70" data-options="required:true">  </textarea>
                    </form>
                  </div>
                </div>
              </div>


              </div>
            </div>

        </main>

      </div>
    </div>
     <input type="hidden" id="code" value="" th:value="${code}">
     <input type="hidden" id="create_time" >
    <script src="../js/jquery-3.3.1.min.js" ></script>
     <script src="../ckeditor/ckeditor.js"></script>
     <script src="../layui/layui.js"></script>
     <script src="../scripts/popper.min.js"></script>
     <script src="../scripts/bootstrap.min.js"></script>
     <script src="../js/jquery.cookie.min.js"></script>
  <script>



    $("#indeximg").on("change",function(){
      function getObjectURL(file) {
        var url = null;
        if (window.createObjcectURL != undefined) {
          url = window.createOjcectURL(file);
        } else if (window.URL != undefined) {
          url = window.URL.createObjectURL(file);
        } else if (window.webkitURL != undefined) {
          url = window.webkitURL.createObjectURL(file);
        }
        return url;
      }
      var blobURL = getObjectURL(this.files[0]);
      var imgUTL = '';

      var xhr = new XMLHttpRequest();
      xhr.open('GET', blobURL);
      xhr.responseType = 'blob';

      xhr.onreadystatechange = function() {
        if (this.readyState === 4 && this.status === 200) {
          var imageBlob = this.response;
          var imageType = imageBlob.type;
          var imageName = null;
          if (imageType.includes('png')) {
            imageName = 'uploaded-image.png';
          } else if (imageType.includes('gif')) {
            imageName = 'uploaded-image.gif';
          } else if (imageType.includes('bmp')) {
            imageName = 'uploaded-image.bmp';
          } else {
            imageName = 'uploaded-image.jpg';
          }
          var form = new FormData();
          form.append('file', imageBlob, imageName); // 第三个参数为文件名
          $.ajax({
            type: 'POST',
            url : "/file/upload",
            data: form ,
            processData: false,
            contentType: false,
          }).done(function(result) {
            $("#indeximgurl").attr("src",result.data);
          });
        }
      };
      xhr.send();
    })

    $("#logo").on("change",function(){
      function getObjectURL(file) {
        var url = null;
        if (window.createObjcectURL != undefined) {
          url = window.createOjcectURL(file);
        } else if (window.URL != undefined) {
          url = window.URL.createObjectURL(file);
        } else if (window.webkitURL != undefined) {
          url = window.webkitURL.createObjectURL(file);
        }
        return url;
      }
      var blobURL = getObjectURL(this.files[0]);
      var imgUTL = '';

      var xhr = new XMLHttpRequest();
      xhr.open('GET', blobURL);
      xhr.responseType = 'blob';

      xhr.onreadystatechange = function() {
        if (this.readyState === 4 && this.status === 200) {
          var imageBlob = this.response;
          var imageType = imageBlob.type;
          var imageName = null;
          if (imageType.includes('png')) {
            imageName = 'uploaded-image.png';
          } else if (imageType.includes('gif')) {
            imageName = 'uploaded-image.gif';
          } else if (imageType.includes('bmp')) {
            imageName = 'uploaded-image.bmp';
          } else {
            imageName = 'uploaded-image.jpg';
          }
          var form = new FormData();
          form.append('file', imageBlob, imageName); // 第三个参数为文件名
          $.ajax({
            type: 'POST',
            url : "/file/upload",
            data: form ,
            processData: false,
            contentType: false,
          }).done(function(result) {
            $("#teacherheadurl").attr("src",result.data);
          });
        }
      };
      xhr.send();
    })

    function remove(obj){
      $(obj).remove();
    }

    layui.use('form', function(){
      var form = layui.form;
    });
    CKEDITOR.replace('newsMatter', {
      height : 600,
      filebrowserImageUploadUrl :  "/file/image"
    });

    $('#newsMatter').each(function () {
      var $textarea = $(this);
      var data=CKEDITOR.instances[$textarea.attr('name')].getData();
      data=data.replace(/&ldquo;/g,'\"');//转义&ldquo; 左双引号
      data=data.replace(/&rdquo;/g,'\"');//转义&ldquo; 右双引号
      $textarea.val(data);
    });

    function savaData(){

      var content = CKEDITOR.instances.newsMatter.getData();
      content=content.replace(/&ldquo;/g,'\"');//转义&ldquo; 左双引号
      content=content.replace(/&rdquo;/g,'\"');//转义&ldquo; 右双引号
      content=content.replace(new RegExp("height",("gm")),'width');//转义&ldquo; 右双引号
      if ($("#title").val() == "" || $("#title").val() == null) {
        layui.use("layer",function() {
          layer.msg('请输入标题');
        }); return false;
      }
      if (content == "" || content == null) {
        layui.use("layer",function() {
          layer.msg('请编辑展示内容');
        }); return false;
      }
    var aaa={};
      if($("#code").val()!=""&&$("#code").val()!=null&&$("#code").val()!=undefined){
      aaa=  {
                "code": $("#code").val(),
                "title": $("#title").val(),
                "content": content,
                "type":$("#type").val(),
                "indeximgurl":$("#indeximgurl").attr('src'),
                "teachername":$("#teachername").val(),
                "teacherheadurl":$("#teacherheadurl").attr('src'),
                "teacherdesc":$("#teacherdesc").val(),
                "teacherslogan":$("#teacherslogan").val(),
                "price": $("#price").val(),
                "pricetype": $("#pricetype").val(),
                "indextype": $("#indextype").val()
        }
      }else {
        aaa={
          "title": $("#title").val(),
                "content": content,
                "type":$("#type").val(),
                "indeximgurl":$("#indeximgurl").attr('src'),
                "teachername":$("#teachername").val(),
                "teacherheadurl":$("#teacherheadurl").attr('src'),
                "teacherdesc":$("#teacherdesc").val(),
                "teacherslogan":$("#teacherslogan").val(),
                "price": $("#price").val(),
                "pricetype": $("#pricetype").val(),
          "indextype": $("#indextype").val(),
          "create_time": $("#create_time").val()
        }
      }


      $.ajax({
        type: 'Put',
        url: "/study/addgroup",
        data: JSON.stringify(aaa),
        processData: false,
        contentType: "application/json; charset=UTF-8",
        headers: {
          "Authorization": "Bearer " + $.cookie("ACCESS_TOKEN"),
          "cache-control": "no-cache",
          "Postman-Token": "0d83bfb4-ef46-46d6-ae5e-02b7a296a3e2"
        }
      }).done(function (result) {
        layui.use("layer", function () {
          layer.alert('保存成功', {
            skin: 'layui-layer-molv' //样式类名
            , closeBtn: 0
            , anim: 4 //动画类型
          }, function () {
            window.location.replace("/managestudysgroup");
          });

        });
      });
    }


    if($("#code").val()!=""&&$("#code").val()!=null&&$("#code").val()!=undefined) {
      $.ajax({
        type: 'GET',
        url: "/study/getgroup?code=" + $("#code").val(),
        async: true,
        crossDomain: true,
        headers: {
          "Authorization": "Bearer " + $.cookie("ACCESS_TOKEN"),
          "cache-control": "no-cache",
          "Postman-Token": "0d83bfb4-ef46-46d6-ae5e-02b7a296a3e2"
        }
      }).done(function (value) {
        $("#title").val(value.data.title);
        $("#price").val(value.data.price);
        $("#videoview").html(" <video id='videourl' controls='controls' src='"+value.data.videourl+"' style='width: 300px;' name='showimage' onclick='remove(this)'>您的浏览器不支持 video 标签。</video>");
        $("#indeximgurl").attr('src', value.data.indeximgurl);
        CKEDITOR.instances.newsMatter.setData(value.data.content);
        $("#teachername").val(value.data.teachername);
        $("#teacherheadurl").attr('src',value.data.teacherheadurl);
        $("#teacherdesc").val(value.data.teacherdesc);
        $("#teacherslogan").val(value.data.teacherslogan);
        $("#create_time").val(value.data.create_time);

        $.ajax({
          type: 'GET',
          url : "/base/studysubject",
          processData: false,
          contentType: false,
        }).done(function(result) {
          result.data.forEach( function (v,i) {
            if(v==value.data.type) {
              $("#type").append("<option value='" + v.name + "' selected>" + v.name + "</option>");
            }else {
              $("#type").append("<option value='" + v.name + "'>" + v.name + "</option>");
            }
          });

        });

      });
    }else{
      $.ajax({
        type: 'GET',
        url : "/base/studysubject",
        processData: false,
        contentType: false,
      }).done(function(result) {
        result.data.forEach( function (v,i) {
          $("#type").append("<option value='"+v.name+"'>"+v.name+"</option>");
        });

      });
    }
    

  </script>
  </body>
</html>